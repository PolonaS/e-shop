angular.module("app",["ui.router","ui.bootstrap","angular-carousel","angular-locker"]),angular.module("app").config(function(t,e,r){e.otherwise("/home"),t.state("home",{url:"/home",controller:"homeController",templateUrl:"templates/home.html"}),t.state("categories",{url:"/categories",controller:"categoryController",templateUrl:"templates/categories.html"}),t.state("product",{url:"/product",templateUrl:"templates/categories.html"}),t.state("basket",{url:"/basket",controller:"basketController",templateUrl:"templates/basket.html"}),t.state("purchase-form",{url:"/purchase-form",controller:"purchaseController",templateUrl:"templates/purchase-form.html"}),t.state("product-details",{url:"/product-details/:productId",controller:"productDetailsController",templateUrl:"templates/product-details.html"}),r.defaults({driver:"local",namespace:"app"})}),angular.module("app").controller("indexController",function(t){null==t.get("basket")&&t.put("basket",[])}),angular.module("app").directive("footerLoad",function(){return{restrict:"E",templateUrl:"templates/footer.html"}}),angular.module("app").directive("headerLoad",function(){return{restrict:"E",templateUrl:"templates/header.html"}}),angular.module("app").controller("basketController",function(t,e,r,o,a){t.basket=a.get("basket"),t.sumAll=2,t.sumAllProducts=function(){for(var r=0,o=0;o<t.basket.length;o++)r+=t.basket[o].product.price*t.basket[o].quantity;return e("currency")(r,"$")},t.deleteProduct=function(e){for(var r=null,o=a.get("basket"),n=0;n<o.length;n++)if(o[n].product.id==e){r=n;break}null!==r&&o.splice(r,1),a.put("basket",o),t.basket=o},t.goToPurchaseForm=function(){r.go("purchase-form")},t.previewBasket=function(){var e=o.open({templateUrl:"templates/modal-template.html",controller:"modalController",resolve:{input:function(){return t.sumAllProducts()}}});e.result.then(function(t){},function(t){alert(t)})}}),angular.module("app").controller("modalController",function(t,e,r){t.data=e,t.ok=function(){r.close("Success")}}),angular.module("app").controller("homeController",function(t,e,r){t.interval=3e3;var o="http://smartninja.betoo.si/api/eshop/categories",a="http://smartninja.betoo.si/api/eshop/products";e.get(o).then(function(r){t.categories=r.data,e.get(a).then(function(e){t.products=e.data;for(var r=0;r<t.products.length;r++)1==t.products[r].onSale&&t.addSlide(t.products[r])},function(t){alert("Products error.")})},function(t){alert("Category error.")}),t.goToDetails=function(t){r.go("product-details",{productId:t})};var n=0;t.slides=[],t.myInterval=2e3,t.noWrapSlides=!1,t.active=0,t.addSlide=function(e){t.slides.push({image:e.image,name:e.name,index:n++,id:e.id})},t.getItems=function(t){return e.get("http://smartninja.betoo.si/api/eshop/products",{params:{query:t}}).then(function(t){return t.data})},t.onSelect=function(t,e,o,a){r.go("product-details",{productId:t.id})}}),angular.module("app").directive("appTypeahead",function(){return{restrict:"E",controller:"homeController",templateUrl:"templates/typeahead-template.html"}}),angular.module("app").controller("categoryController",function(t,e,r){var o="http://smartninja.betoo.si/api/eshop/categories",a="http://smartninja.betoo.si/api/eshop/products",n=[];e.get(o).then(function(r){t.categories=r.data;for(var o=0;o<t.categories.length;o++)t.categoryOptions[t.categories[o].id]=!0;e.get(a).then(function(e){n=e.data,t.products=e.data},function(t){alert("Products error.")})},function(t){alert("Category error.")}),t.goToDetails=function(t){r.go("product-details",{productId:t})},t.categoryOptions=[],t.filterOnCategories=function(){t.products=[],console.log(t.categoryOptions);for(var e=0;e<n.length;e++){var r=n[e].categoryId;t.categoryOptions[r]&&1==t.categoryOptions[r]&&t.products.push(n[e])}}}),angular.module("app").controller("productDetailsController",function(t,e,r,o){var a=r.productId,n="http://smartninja.betoo.si/api/eshop/products";e.get(n+"/"+a).then(function(e){t.product=e.data},function(t){alert("Category error.")}),t.isOnStock=function(t){return 0===t?"Temporary out of stock.":t},t.isOnSale=function(t){return 1==t?"This product has a special offer of -30%. Don't miss it!":"No discount to this product."},t.isAvailable=function(t){return null==t?"unknown":"Not available until "+t+"."},t.isCategory=function(t){switch(t){case 1:return"Big Toys";case 2:return"Medium Toys";case 3:return"Small Toys";case 4:return"Games"}},t.addToBasket=function(t,e){if(e>0&&e<=t.stock){for(var r=!1,a=o.get("basket"),n=0;n<a.length;n++)if(a[n].product.id==t.id){if(a[n].quantity+parseInt(e)>t.stock)return void alert("Too much");a[n].quantity+=parseInt(e),r=!0}0==r&&a.push({product:t,quantity:parseInt(e)}),o.put("basket",a)}else alert("Not enought products in stock.")}}),angular.module("app").directive("appDatepicker",function(){return{restrict:"E",controller:"purchaseController",templateUrl:"templates/datepicker-directive.html"}}),angular.module("app").controller("purchaseController",function(t,e,r){var o="http://smartninja.betoo.si/api/eshop/orders";t.sendData=function(){for(var a=[],n=r.get("basket"),l=0;l<n.length;l++)a.push({id:n[l].product.id,quantity:n[l].quantity});var u={firstName:t.firstName,lastName:t.lastName,email:t.email,address:t.address,country:t.country,city:t.city,zip:t.zip,products:a,date:t.date,time:t.time};e.post(o,u).then(function(t){r.put("basket",[]),alert("Your order has been sent.")},function(t){alert("An error occured. Check all input fields.")})},t.open=function(e){e.preventDefault(),e.stopPropagation(),t.opened=!0}}),angular.module("app").directive("appTimepicker",function(){return{restrict:"E",controller:"purchaseController",templateUrl:"templates/purchase-form.html"}});